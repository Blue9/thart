{"version":3,"sources":["../src/validators.ts"],"sourcesContent":["import type {\n  PrimaryFunction,\n  ThartOptions,\n  WorkerCount,\n  WorkerFunction,\n} from \"./types\";\n\nexport const validateOptions = (opts: ThartOptions) => {\n  if (typeof opts !== \"object\" || opts === null) {\n    throw new TypeError(\"Options must be an optiona\");\n  }\n\n  // assert one of \"primary\" or \"worker\" is present in the options\n  if (!(\"primary\" in opts) && !(\"worker\" in opts)) {\n    throw new TypeError(\"Must specify a `primary` or `worker` config\");\n  }\n\n  if (\"grace\" in opts) {\n    if (typeof opts.grace !== \"number\" || opts.grace < 0) {\n      throw new TypeError(\"Grace period must be a non-negative number\");\n    }\n  }\n\n  if (\"primary\" in opts) _validatePrimaryFunction(opts.primary);\n  if (\"worker\" in opts) {\n    if (Array.isArray(opts.worker)) {\n      opts.worker.forEach(_validateWorkerFunction);\n    } else {\n      _validateWorkerFunction(opts.worker);\n    }\n  }\n};\n\nconst _validatePrimaryFunction = (primary: PrimaryFunction) => {\n  if (typeof primary !== \"object\" || primary === null) {\n    throw new TypeError(\"Primary configuration must be an object\");\n  }\n\n  if (typeof primary.start !== \"function\") {\n    throw new TypeError(\"Primary start must be a provided function\");\n  }\n\n  if (\"stop\" in primary && typeof primary.stop !== \"function\") {\n    throw new TypeError(\"Primary stop, if provided, must be a function\");\n  }\n};\n\nconst _validateWorkerFunction = (\n  worker: WorkerFunction & Partial<WorkerCount>,\n) => {\n  if (typeof worker !== \"object\" || worker === null) {\n    throw new TypeError(\"Worker configuration must be an object\");\n  }\n\n  if (typeof worker.start !== \"function\") {\n    throw new TypeError(\"Worker start must be a provided function\");\n  }\n\n  if (![\"childProcess\", \"cluster\"].includes(worker.type)) {\n    throw new TypeError(\n      'Worker type must be either \"childProcess\" or \"cluster\"',\n    );\n  }\n\n  if (\"stop\" in worker && typeof worker.stop !== \"function\") {\n    throw new TypeError(\"Worker stop, if provided, must be a function\");\n  }\n\n  if (\"startupTimeoutMs\" in worker) {\n    if (\n      typeof worker.startupTimeoutMs !== \"number\" ||\n      worker.startupTimeoutMs < 0\n    ) {\n      throw new TypeError(\n        \"Worker startupTimeoutMs, if provided, must be a non-negative number\",\n      );\n    }\n  }\n\n  if (\"count\" in worker) {\n    const count = worker.count;\n    if (typeof count !== \"number\" || count < 1 || !Number.isInteger(count)) {\n      throw new TypeError(\"Worker count must be a positive integer\");\n    }\n  }\n\n  if (\n    \"killAfterCompleted\" in worker &&\n    typeof worker.killAfterCompleted !== \"boolean\"\n  ) {\n    throw new TypeError(\n      \"Worker killAfterCompleted, if provided, must be a boolean\",\n    );\n  }\n};\n"],"mappings":";AAOO,IAAM,kBAAkB,CAAC,SAAuB;AACrD,MAAI,OAAO,SAAS,YAAY,SAAS,MAAM;AAC7C,UAAM,IAAI,UAAU,4BAA4B;AAAA,EAClD;AAGA,MAAI,EAAE,aAAa,SAAS,EAAE,YAAY,OAAO;AAC/C,UAAM,IAAI,UAAU,6CAA6C;AAAA,EACnE;AAEA,MAAI,WAAW,MAAM;AACnB,QAAI,OAAO,KAAK,UAAU,YAAY,KAAK,QAAQ,GAAG;AACpD,YAAM,IAAI,UAAU,4CAA4C;AAAA,IAClE;AAAA,EACF;AAEA,MAAI,aAAa,KAAM,0BAAyB,KAAK,OAAO;AAC5D,MAAI,YAAY,MAAM;AACpB,QAAI,MAAM,QAAQ,KAAK,MAAM,GAAG;AAC9B,WAAK,OAAO,QAAQ,uBAAuB;AAAA,IAC7C,OAAO;AACL,8BAAwB,KAAK,MAAM;AAAA,IACrC;AAAA,EACF;AACF;AAEA,IAAM,2BAA2B,CAAC,YAA6B;AAC7D,MAAI,OAAO,YAAY,YAAY,YAAY,MAAM;AACnD,UAAM,IAAI,UAAU,yCAAyC;AAAA,EAC/D;AAEA,MAAI,OAAO,QAAQ,UAAU,YAAY;AACvC,UAAM,IAAI,UAAU,2CAA2C;AAAA,EACjE;AAEA,MAAI,UAAU,WAAW,OAAO,QAAQ,SAAS,YAAY;AAC3D,UAAM,IAAI,UAAU,+CAA+C;AAAA,EACrE;AACF;AAEA,IAAM,0BAA0B,CAC9B,WACG;AACH,MAAI,OAAO,WAAW,YAAY,WAAW,MAAM;AACjD,UAAM,IAAI,UAAU,wCAAwC;AAAA,EAC9D;AAEA,MAAI,OAAO,OAAO,UAAU,YAAY;AACtC,UAAM,IAAI,UAAU,0CAA0C;AAAA,EAChE;AAEA,MAAI,CAAC,CAAC,gBAAgB,SAAS,EAAE,SAAS,OAAO,IAAI,GAAG;AACtD,UAAM,IAAI;AAAA,MACR;AAAA,IACF;AAAA,EACF;AAEA,MAAI,UAAU,UAAU,OAAO,OAAO,SAAS,YAAY;AACzD,UAAM,IAAI,UAAU,8CAA8C;AAAA,EACpE;AAEA,MAAI,sBAAsB,QAAQ;AAChC,QACE,OAAO,OAAO,qBAAqB,YACnC,OAAO,mBAAmB,GAC1B;AACA,YAAM,IAAI;AAAA,QACR;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAEA,MAAI,WAAW,QAAQ;AACrB,UAAM,QAAQ,OAAO;AACrB,QAAI,OAAO,UAAU,YAAY,QAAQ,KAAK,CAAC,OAAO,UAAU,KAAK,GAAG;AACtE,YAAM,IAAI,UAAU,yCAAyC;AAAA,IAC/D;AAAA,EACF;AAEA,MACE,wBAAwB,UACxB,OAAO,OAAO,uBAAuB,WACrC;AACA,UAAM,IAAI;AAAA,MACR;AAAA,IACF;AAAA,EACF;AACF;","names":[]}